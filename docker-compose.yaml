version: "2.1"
services:
#  server:
#    image: jetbrains/teamcity-server:${TEAMCITY_VERSION}
#    ports:
#      - "8112:8111"
#    volumes:
#      - ./teamcity-server/data://C/ProgramData/JetBrains/TeamCity
#      - ./teamcity-server/logs://C/TeamCity/logs
#    mem_limit: 2g
  agent:
    container_name: teamcity-agent
    image: jetbrains/teamcity-agent:${TEAMCITY_VERSION}
    environment:
      - SERVER_URL=http://192.168.29.112:8111
      - AGENT_NAME=teamcity-agent
      - DOCKER_IN_DOCKER=start
      - TEAMCITY_SERVER_MEM_OPTS=-Xmx2g -XX:ReservedCodeCacheSize=350m
    privileged: true
#    volumes:
#      - /storage/docker-volumes/teamcity/agent1:/data/teamcity_agent/conf
#      - /var/run/docker.sock:/var/run/docker.sock
#      - /storage/docker-volumes/teamcity/agent1/work:/opt/buildagent/work
#      - /storage/docker-volumes/teamcity/agent1/temp:/opt/buildagent/temp
#      - /storage/docker-volumes/teamcity/agent1/tools:/opt/buildagent/tools
#      - /storage/docker-volumes/teamcity/agent1/plugins:/opt/buildagent/plugins
#      - /storage/docker-volumes/teamcity/agent1/system:/opt/buildagent/system
#    restart: unless-stopped